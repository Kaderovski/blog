<!doctype html><html><head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge"><title>Little Web Monitoring - Kaderovski</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Sometimes making small OneJob services is efficient in terms of time, organization, functionality. In the example of this article, I will try to show how it can be relevant to write `microscripts&rsquo; under this model.
Let&rsquo;s say we want to make sure, for a given list of sites, that they all return 200 codes in less than 2s, in which case we&rsquo;ll get a notification on Slack. The sources for these posts are available here.">
<meta property="og:image" content>
<meta property="og:title" content="Little Web Monitoring">
<meta property="og:description" content="Sometimes making small OneJob services is efficient in terms of time, organization, functionality. In the example of this article, I will try to show how it can be relevant to write `microscripts&rsquo; under this model.
Let&rsquo;s say we want to make sure, for a given list of sites, that they all return 200 codes in less than 2s, in which case we&rsquo;ll get a notification on Slack. The sources for these posts are available here.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://kaderovski.com/posts/little-web-monitoring/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2017-08-02T08:22:16+00:00">
<meta property="article:modified_time" content="2017-08-02T08:22:16+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Little Web Monitoring">
<meta name=twitter:description content="Sometimes making small OneJob services is efficient in terms of time, organization, functionality. In the example of this article, I will try to show how it can be relevant to write `microscripts&rsquo; under this model.
Let&rsquo;s say we want to make sure, for a given list of sites, that they all return 200 codes in less than 2s, in which case we&rsquo;ll get a notification on Slack. The sources for these posts are available here.">
<script src=https://kaderovski.com/js/feather.min.js></script>
<link href=https://kaderovski.com/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet>
<link rel=stylesheet type=text/css media=screen href=https://kaderovski.com/css/main.012e5aa5cb264fd430bd3ad5b7db828508ccc0fc66b280031de12b7eec06ef85.css>
</head><body>
<div class=content><header>
<div class=main>
<a href=https://kaderovski.com>Kaderovski</a>
</div><nav>
<a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/about>About</a>
<a href=https://photos.kaderovski.com>Photos</a>
<a href=/cv>CV</a>
</nav></header><main>
<article>
<div class=title>
<h1 class=title>Little Web Monitoring</h1><div class=meta>Posted on Aug 2, 2017</div></div><section class=body>
<p>Sometimes making small <code>OneJob</code> services is efficient in terms of time, organization, functionality.
In the example of this article, I will try to show how it can be relevant to write `microscripts&rsquo; under this model.</p><p>Let&rsquo;s say we want to make sure, for a given list of sites, that they all return <code>200</code> codes in less than <code>2s</code>, in which case we&rsquo;ll get a notification on <code>Slack</code>.
The sources for these posts are available <a href=https://github.com/Kaderovski/Slack-Bot-Web-Alert/blob/master/bot.py>here</a>.</p><p>For the language, <code>python3</code> will be more than enough.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>#!/bin/python3.6
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>import requests
</span></span><span style=display:flex><span>import time
</span></span><span style=display:flex><span>from slackclient import SlackClient
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>slack_token = &#34;YOUR_TOKEN_HERE&#34;
</span></span><span style=display:flex><span>sc = SlackClient(slack_token)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>urls=[&#39;site1&#39;, &#39;site2&#39;, &#39;site3&#39;]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>while True :
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    for i in urls :
</span></span><span style=display:flex><span>        r = requests.head(i)
</span></span><span style=display:flex><span>        t = requests.get(i, timeout=5).elapsed.total_seconds()
</span></span><span style=display:flex><span>        # print(i, r.status_code, t)
</span></span><span style=display:flex><span>        time.sleep(2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        if r.status_code != 200 :
</span></span><span style=display:flex><span>            sc.api_call(
</span></span><span style=display:flex><span>            &#34;chat.postMessage&#34;,
</span></span><span style=display:flex><span>            channel=&#34;#infra&#34;,
</span></span><span style=display:flex><span>            text=(&#34;ALERTE !&#34;, i, r.status_code)
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        if t &gt; 2 :
</span></span><span style=display:flex><span>            sc.api_call(
</span></span><span style=display:flex><span>            &#34;chat.postMessage&#34;,
</span></span><span style=display:flex><span>            channel=&#34;#infra&#34;,
</span></span><span style=display:flex><span>            text=(&#34;LoadSite too long : &#34;, i, r.status_code)
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    time.sleep(10)
</span></span></code></pre></div><p>Let’s checkout what we have here :</p><p>We are using :</p><ul>
<li><code>requests</code> to be able to call sites/url</li><li><code>time</code> to pause code.</li><li><code>SlackClient</code> to be notified.</li></ul><p>In the end, with only 30-35 lines of code, we are able to ensure <strong>quickly</strong> the proper functioning of a list of sites.
It takes less than 10 minutes to code, it&rsquo;s &ldquo;fast&rdquo;, &ldquo;light&rdquo; and &ldquo;portable&rdquo; everywhere.</p><p>The advantage of this type of scripts is that they are very modular, adding features is just as fast as developing the code and you make sure you only get the information you need, which is a real advantage in terms of performance.</p></section><div class=post-tags>
<nav class="nav tags">
<ul class=tags>
<li><a href=/tags/script>script</a></li><li><a href=/tags/python>python</a></li><li><a href=/tags/monitoring>monitoring</a></li></ul></nav></div></article></main><footer>
<div style=display:flex><a class=soc href=https://github.com/corentinderet title=GitHub><i data-feather=github></i></a><a class=soc href=https://gitlab.com/f00b4rch title=GitLab><i data-feather=gitlab></i></a></div><div class=footer-info>
2022 © Kaderovski
</div></footer><script>feather.replace()</script></div></body></html>