<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Script restart services - Kaderovski</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Sometimes, we find ourselves having to pilote infrastructures services supported by panels managements and &mldr; between us, I have a holy horror of Plesk, Cpanel, Ispconfig, Webmin &mldr; Especially when under certain circumstances some components are falling down. It&rsquo;s often badly done and messy that it&rsquo;s difficult to find your way around. Between abobinable logs management (yes, I already found php logs in syslog), a non-existent server optimization&mldr; well I stop here because it is not the purpose of this post."><meta property="og:image" content><meta property="og:title" content="Script restart services"><meta property="og:description" content="Sometimes, we find ourselves having to pilote infrastructures services supported by panels managements and &mldr; between us, I have a holy horror of Plesk, Cpanel, Ispconfig, Webmin &mldr; Especially when under certain circumstances some components are falling down. It&rsquo;s often badly done and messy that it&rsquo;s difficult to find your way around. Between abobinable logs management (yes, I already found php logs in syslog), a non-existent server optimization&mldr; well I stop here because it is not the purpose of this post."><meta property="og:type" content="article"><meta property="og:url" content="https://kaderovski.com/posts/script-restart-services/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-08-18T22:29:53+02:00"><meta property="article:modified_time" content="2017-08-18T22:29:53+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Script restart services"><meta name=twitter:description content="Sometimes, we find ourselves having to pilote infrastructures services supported by panels managements and &mldr; between us, I have a holy horror of Plesk, Cpanel, Ispconfig, Webmin &mldr; Especially when under certain circumstances some components are falling down. It&rsquo;s often badly done and messy that it&rsquo;s difficult to find your way around. Between abobinable logs management (yes, I already found php logs in syslog), a non-existent server optimization&mldr; well I stop here because it is not the purpose of this post."><script src=https://kaderovski.com//js/feather.min.js></script>
<link href=https://kaderovski.com/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://kaderovski.com/css/main.012e5aa5cb264fd430bd3ad5b7db828508ccc0fc66b280031de12b7eec06ef85.css><link id=darkModeStyle rel=stylesheet type=text/css href=https://kaderovski.com/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css disabled></head><body><div class=content><header><div class=main><a href=https://kaderovski.com/>Kaderovski</a></div><nav><a href=/>Home</a>
<a href=/posts>Posts</a>
<a href=/about>About</a>
<a href=https://photos.kaderovski.com>Photos</a>
<a href=/cv>CV</a>
| <a id=dark-mode-toggle onclick=toggleTheme() href></a>
<script src=https://kaderovski.com/js/themetoggle.js></script></nav></header><main><article><div class=title><h1 class=title>Script restart services</h1><div class=meta>Posted on Aug 18, 2017</div></div><section class=body><p>Sometimes, we find ourselves having to pilote infrastructures services supported by panels managements and &mldr; between us, I have a holy horror of Plesk, Cpanel, Ispconfig, Webmin &mldr;
Especially when under certain circumstances some components are falling down.
It&rsquo;s often badly done and messy that it&rsquo;s difficult to find your way around. Between abobinable logs management (yes, I already found php logs in syslog), a non-existent server optimization&mldr; well I stop here because it is not the purpose of this post.</p><p>In fact, what happened lately is that I discovered on a &ldquo;certain version&rdquo; of a &ldquo;certain panel&rdquo; that I won&rsquo;t write here, php-fpm is crashing miserably and randomly. Of course, just to make it funny, this incident leads to a service outage for about 200 users, cool no?</p><p>So, at some point you have to say f*ck and drive the mess properly, so you get the bash out.
So yes, you tell me, why bother, just use a service like monit? Well I tested but no.</p><p>So, just to make it right, we start our script the following way.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>set -euo pipefail
</span></span><span style=display:flex><span>IFS<span style=color:#f92672>=</span><span style=color:#e6db74>$&#39;\n\t&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/ Usage: ./main.sh</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/ Description: This script monitore services</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/ Examples: ./main.sh</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/ Options:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/   --help: Display this help message</span>
</span></span><span style=display:flex><span>usage<span style=color:#f92672>()</span> <span style=color:#f92672>{</span> grep <span style=color:#e6db74>&#39;^#/&#39;</span> <span style=color:#e6db74>&#34;</span>$0<span style=color:#e6db74>&#34;</span> | cut -c4- ; exit <span style=color:#ae81ff>0</span> ; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>expr <span style=color:#e6db74>&#34;</span>$*<span style=color:#e6db74>&#34;</span> : <span style=color:#e6db74>&#34;.*--help&#34;</span> &gt; /dev/null <span style=color:#f92672>&amp;&amp;</span> usage
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>readonly LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/tmp/</span><span style=color:#66d9ef>$(</span>basename <span style=color:#e6db74>&#34;</span>$0<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>.log&#34;</span>
</span></span><span style=display:flex><span>info<span style=color:#f92672>()</span>    <span style=color:#f92672>{</span> echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date -u<span style=color:#66d9ef>)</span><span style=color:#e6db74> [INFO]    </span>$*<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span> ; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>warning<span style=color:#f92672>()</span> <span style=color:#f92672>{</span> echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date -u<span style=color:#66d9ef>)</span><span style=color:#e6db74> [WARNING] </span>$*<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span> ; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>error<span style=color:#f92672>()</span>   <span style=color:#f92672>{</span> echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date -u<span style=color:#66d9ef>)</span><span style=color:#e6db74> [ERROR]   </span>$*<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span> ; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>fatal<span style=color:#f92672>()</span>   <span style=color:#f92672>{</span> echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date -u<span style=color:#66d9ef>)</span><span style=color:#e6db74> [FATAL]   </span>$*<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span> ; exit <span style=color:#ae81ff>1</span> ; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Debug</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Cleaning if exit</span>
</span></span><span style=display:flex><span>cleanup<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    rm <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>trap cleanup EXIT
</span></span></code></pre></div><p>So far, nothing extraordinary, we have our shebang, different logging functions and a clean service with trap.</p><p>As I like to be alerted of the actions of my scripts, we&rsquo;re going to declare a mail sending function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># Func mail
</span></span><span style=display:flex><span>sendMail() {
</span></span><span style=display:flex><span>    echo &#34;$(date) : $1 restarted on $HOSTNAME&#34; | mail -s &#34;$1 restarted on $HOSTNAME&#34; &#34;my@mail&#34;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We will then declare our function for a given service (at random, a service that never falls&mldr;):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span># Func php-fpm
</span></span><span style=display:flex><span>php-fpm() {
</span></span><span style=display:flex><span>if pgrep php5-fpm &gt; /dev/null
</span></span><span style=display:flex><span>then
</span></span><span style=display:flex><span>    info &#34;Php-FPM service is up.&#34;
</span></span><span style=display:flex><span>:
</span></span><span style=display:flex><span>else
</span></span><span style=display:flex><span>       warning &#34;Php-FPM service down, restarting it !&#34;
</span></span><span style=display:flex><span>       if /etc/init.d/php5-fpm restart &gt; /dev/null
</span></span><span style=display:flex><span>       then
</span></span><span style=display:flex><span>           info &#34;Php-FPM service restarted&#34;
</span></span><span style=display:flex><span>           sendMail &#34;php-FPM&#34;
</span></span><span style=display:flex><span>       fi
</span></span><span style=display:flex><span>fi
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here we check if the service has an active pid, in which case it is restarted, logged and sent a mail.</p><p>Repeat the operation with the other services involved if necessary and call the main:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>if [[ &#34;${BASH_SOURCE[0]}&#34; = &#34;$0&#34; ]]; then
</span></span><span style=display:flex><span>    info &#34;Starting...&#34;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    while true; do
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        # Functions call
</span></span><span style=display:flex><span>        php-fpm
</span></span><span style=display:flex><span>        sleep 5
</span></span><span style=display:flex><span>        # vos autres fonctions ici
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    done
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fi
</span></span></code></pre></div><p>Full version :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>set -euo pipefail
</span></span><span style=display:flex><span>IFS<span style=color:#f92672>=</span><span style=color:#e6db74>$&#39;\n\t&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/ Usage: ./main.sh</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/ Description: This script monitore Plesk Web services</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/ Examples: ./main.sh</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/ Options:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#/   --help: Display this help message</span>
</span></span><span style=display:flex><span>usage<span style=color:#f92672>()</span> <span style=color:#f92672>{</span> grep <span style=color:#e6db74>&#39;^#/&#39;</span> <span style=color:#e6db74>&#34;</span>$0<span style=color:#e6db74>&#34;</span> | cut -c4- ; exit <span style=color:#ae81ff>0</span> ; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>expr <span style=color:#e6db74>&#34;</span>$*<span style=color:#e6db74>&#34;</span> : <span style=color:#e6db74>&#34;.*--help&#34;</span> &gt; /dev/null <span style=color:#f92672>&amp;&amp;</span> usage
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>readonly LOG_FILE<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/tmp/</span><span style=color:#66d9ef>$(</span>basename <span style=color:#e6db74>&#34;</span>$0<span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>.log&#34;</span>
</span></span><span style=display:flex><span>info<span style=color:#f92672>()</span>    <span style=color:#f92672>{</span> echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date -u<span style=color:#66d9ef>)</span><span style=color:#e6db74> [INFO]    </span>$*<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span> ; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>warning<span style=color:#f92672>()</span> <span style=color:#f92672>{</span> echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date -u<span style=color:#66d9ef>)</span><span style=color:#e6db74> [WARNING] </span>$*<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span> ; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>error<span style=color:#f92672>()</span>   <span style=color:#f92672>{</span> echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date -u<span style=color:#66d9ef>)</span><span style=color:#e6db74> [ERROR]   </span>$*<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span> ; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>fatal<span style=color:#f92672>()</span>   <span style=color:#f92672>{</span> echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date -u<span style=color:#66d9ef>)</span><span style=color:#e6db74> [FATAL]   </span>$*<span style=color:#e6db74>&#34;</span> | tee -a <span style=color:#e6db74>&#34;</span>$LOG_FILE<span style=color:#e6db74>&#34;</span> &gt;&amp;<span style=color:#ae81ff>2</span> ; exit <span style=color:#ae81ff>1</span> ; <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Debug</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Cleaning if exit</span>
</span></span><span style=display:flex><span><span style=color:#75715e># cleanup() {</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     rm &#34;$LOG_FILE&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># }</span>
</span></span><span style=display:flex><span><span style=color:#75715e># trap cleanup EXIT</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Functions </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Func mail</span>
</span></span><span style=display:flex><span>    sendMail<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date<span style=color:#66d9ef>)</span><span style=color:#e6db74> : </span>$1<span style=color:#e6db74> restarted on </span>$HOSTNAME<span style=color:#e6db74>&#34;</span> | mail -s <span style=color:#e6db74>&#34;</span>$1<span style=color:#e6db74> restarted on </span>$HOSTNAME<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&#34;my@mail&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Func nginx</span>
</span></span><span style=display:flex><span>    nginx<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> pgrep nginx &gt; /dev/null
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#        info &#34;Nginx service is up.&#34;</span>
</span></span><span style=display:flex><span>    :
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>            warning <span style=color:#e6db74>&#34;Nginx service down, restarting it !&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> /etc/init.d/nginx restart &gt; /dev/null
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>                info <span style=color:#e6db74>&#34;Nginx service restarted&#34;</span>
</span></span><span style=display:flex><span>                sendMail <span style=color:#e6db74>&#34;nginx&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Func php-fpm</span>
</span></span><span style=display:flex><span>    php-fpm<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> pgrep php5-fpm &gt; /dev/null
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#        info &#34;Php-FPM service is up.&#34;</span>
</span></span><span style=display:flex><span>    :
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>           warning <span style=color:#e6db74>&#34;Php-FPM service down, restarting it !&#34;</span>
</span></span><span style=display:flex><span>           <span style=color:#66d9ef>if</span> /etc/init.d/php5-fpm restart &gt; /dev/null
</span></span><span style=display:flex><span>           <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>               info <span style=color:#e6db74>&#34;Php-FPM service restarted&#34;</span>
</span></span><span style=display:flex><span>               sendMail <span style=color:#e6db74>&#34;php-FPM&#34;</span>
</span></span><span style=display:flex><span>           <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Func mysql</span>
</span></span><span style=display:flex><span>    mysql<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> pgrep mysql &gt; /dev/null
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#        info &#34;Mysql service is up.&#34;</span>
</span></span><span style=display:flex><span>    :
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        warning <span style=color:#e6db74>&#34;Mysql service down, restarting it !&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> /etc/init.d/mysql restart &gt; /dev/null 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            info <span style=color:#e6db74>&#34;Mysql service restarted&#34;</span>
</span></span><span style=display:flex><span>            sendMail <span style=color:#e6db74>&#34;mysql&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Func apache</span>
</span></span><span style=display:flex><span>    apache<span style=color:#f92672>(){</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> pgrep apache2 &gt; /dev/null
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#        info &#34;Apache2 service is up.&#34;</span>
</span></span><span style=display:flex><span>    :
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        warning <span style=color:#e6db74>&#34;Apache2 service down, restarting it !&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> /etc/init.d/apache2 restart &gt; /dev/null 
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>            info <span style=color:#e6db74>&#34;Apache2 service restarted&#34;</span>
</span></span><span style=display:flex><span>            sendMail <span style=color:#e6db74>&#34;apache2&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>BASH_SOURCE[0]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span>$0<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># If root :</span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> <span style=color:#f92672>[[</span> $EUID -ne <span style=color:#ae81ff>0</span> <span style=color:#f92672>]]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    	echo <span style=color:#e6db74>&#34;This script must be run as root&#34;</span>
</span></span><span style=display:flex><span>    	exit <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    info <span style=color:#e6db74>&#34;Starting...&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> true; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Functions call</span>
</span></span><span style=display:flex><span>        nginx    	
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>        php-fpm
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>        mysql
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>        apache
</span></span><span style=display:flex><span>        sleep <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>Well, it&rsquo;s nothing too crazy, but I find that doing things manually really helps you target exactly what you want to do.</p><p>As usual, the sources are available!</p><p>In a future post, we&rsquo;ll see how to factorize all this script to avoid repetition and make it more readable.</p><p>See you soon!</p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/linux>linux</a></li><li><a href=/tags/bash>bash</a></li><li><a href=/tags/script>script</a></li></ul></nav></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/kaderovski title=GitHub><i data-feather=github></i></a><a class=soc href=https://gitlab.com/kaderovski title=GitLab><i data-feather=gitlab></i></a></div><div class=footer-info>2022 © Kaderovski</div></footer><script>feather.replace()</script></div></body></html>